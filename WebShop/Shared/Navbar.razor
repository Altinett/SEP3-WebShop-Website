@using WebShop.Services.HTTP
@using BlazorWasm.Services.Http
@using global::Shared
@using WebShop.Pages
@inject NavigationManager Nvm

<div class="topnav">
        <div class="primary-icon-button round " @onclick="OnHomeClick" >
<svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512">
  <path d="M256 112a56 56 0 1156-56 56.06 56.06 0 01-56 56z" fill="#ffffff"/>
  <path d="M432 112.8l-.45.12-.42.13c-1 .28-2 .58-3 .89-18.61 5.46-108.93 30.92-172.56 30.92-59.13 0-141.28-22-167.56-29.47a73.79 73.79 0 00-8-2.58c-19-5-32 14.3-32 31.94 0 17.47 15.7 25.79 31.55 31.76v.28l95.22 29.74c9.73 3.73 12.33 7.54 13.6 10.84 4.13 10.59.83 31.56-.34 38.88l-5.8 45-32.19 176.19q-.15.72-.27 1.47l-.23 1.27c-2.32 16.15 9.54 31.82 32 31.82 19.6 0 28.25-13.53 32-31.94s28-157.57 42-157.57 42.84 157.57 42.84 157.57c3.75 18.41 12.4 31.94 32 31.94 22.52 0 34.38-15.74 32-31.94a57.17 57.17 0 00-.76-4.06L329 301.27l-5.79-45c-4.19-26.21-.82-34.87.32-36.9a1.09 1.09 0 00.08-.15c1.08-2 6-6.48 17.48-10.79l89.28-31.21a16.9 16.9 0 001.62-.52c16-6 32-14.3 32-31.93S451 107.81 432 112.8z" fill="#ffffff"/>
</svg>
    
        </div>
    <div class="primary-icon-button round " @onclick="OnHomeClick">
        <svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512" fill="#fff" style="height: 1.8rem;"><path d="M416 174.74V48h-80v58.45L256 32 0 272h64v208h144V320h96v160h144V272h64l-96-97.26z"/></svg>

    </div>
    <div class="secondary-button round" @onclick="OnAllCategoriesClick">
        <div class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M80 160h352M80 256h352M80 352h352"/></svg>
        </div>
        <a class="active">Alle kategorier</a>
    </div>

    <form @onsubmit="OnSearch">
        <label class="search round" for="search-input">
            <input @bind="searchQuery" type="text" id="search-input" spellcheck="false" placeholder="Search">
            <div class="icon" @onclick="OnSearch">
                <svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512"><path d="M221.09 64a157.09 157.09 0 10157.09 157.09A157.1 157.1 0 00221.09 64z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M338.29 338.29L448 448"/></svg>
            </div>
        </label>
    </form>


    <a @onclick="OnContactClick">Kontakt os</a>
    
    <a @onclick="OnAboutClick">Om os</a>
    
    <div class="primary-button round" @onclick="OnCartClick">
        <div class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512"><path d="M68.4 192A20.38 20.38 0 0048 212.2a17.87 17.87 0 00.8 5.5L100.5 400a40.46 40.46 0 0039.1 29.5h232.8a40.88 40.88 0 0039.3-29.5l51.7-182.3.6-5.5a20.38 20.38 0 00-20.4-20.2H68.4zm193.32 160.07A42.07 42.07 0 11304 310a42.27 42.27 0 01-42.28 42.07z" fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32"/><path fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" d="M160 192l96-128 96 128"/></svg>
        </div>
        <a class="active">Indkøbskurv </a>
        @if (BasketService.getInstance().GetAmountInBasket == null || BasketService.getInstance().GetAmountInBasket() == 0)
        {
        }
        else
        { //TODO make the "Indkøbskurv" CSS better/good.
            <p class="BasketNumber round"> @(BasketService.getInstance().GetAmountInBasket()) </p>
        }
    </div>

</div>



@code {
    

    private SearchService _searchService = SearchService.getInstance();
    private ProductService _productService = ProductService.getInstance();

    public string searchQuery = "";

    protected override Task OnInitializedAsync() {
        BasketService.getInstance().on("Changed", e =>
        {
            StateHasChanged();
        });
        searchQuery = _searchService.GetCurrentQuery();
        StateHasChanged();
        
        return base.OnInitializedAsync();
    }

    public void OnSearch()
    {
        // Set current search query to input field value and emit the search event
        _searchService.SetCurrentQuery(searchQuery);
        _searchService.emit("search", searchQuery);
        
        // Navigate to browse page and make sure the categories are the same when navigating
        Nvm.NavigateTo("/browse/" + String.Join(",", _searchService.GetCurrentCategories()));
        Reload();
    }

    private void Reload()
    {
        Nvm.NavigateTo("/temp");
        Nvm.NavigateTo("/browse"); 
    }

    public void OnAllCategoriesClick()
    {
        _searchService.SetCurrentQuery("");
        Reload();
    }
    
    
    public void OnCartClick()
    {
        Nvm.NavigateTo("/kurv");
    }

    public void OnHomeClick()
    {
        Nvm.NavigateTo("/");
    }
    
    public void OnContactClick()
    {
        Nvm.NavigateTo("/Contact");
    }

    public void OnAboutClick()
    {
        Nvm.NavigateTo("/About");
    }

    public void OnAccessibilityClick()
    {
        
    }
    
    
    
    //TODO når det lægges i kurven, vil det være rart at se antal vare i kurv.

}