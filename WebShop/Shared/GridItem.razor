@using global::Shared
@using WebShop.Pages

<div class="grid-item">
	<img src="data:image/png;base64, @Img" />
	<!--<img src="@Img"/>-->
	<a class="title" href="#">@name</a>
	@if (InBasket == false)
	{
	}
	else
	{
		<div class="bottom">
			<div class="price">DKK @price</div>
			@if (InStock)
			{
				<div class="stock-status in-stock">På lager</div>
			}
			else
			{
				<div class="stock-status not-in-stock">Ikke på lager</div>
			}
		</div>
		@if (InBasket == true)
		{
			<div class="button" @onclick="RemoveFromBasket">
				<Icon Name="basket"/>
				<!--
				<svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512"><path d="M68.4 192A20.38 20.38 0 0048 212.2a17.87 17.87 0 00.8 5.5L100.5 400a40.46 40.46 0 0039.1 29.5h232.8a40.88 40.88 0 0039.3-29.5l51.7-182.3.6-5.5a20.38 20.38 0 00-20.4-20.2H68.4zm193.32 160.07A42.07 42.07 0 11304 310a42.27 42.27 0 01-42.28 42.07z" fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32"/><path fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" d="M160 192l96-128 96 128"/></svg>
				-->
				
				<a>Fjern fra kurv</a>
			</div>
		}
		else if (InBasket == false)
		{

		}
		else
		{
			<div class="button" @onclick="AddToBasket">
				<Icon Name="basket"/>
				<!--
				<svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512"><path d="M68.4 192A20.38 20.38 0 0048 212.2a17.87 17.87 0 00.8 5.5L100.5 400a40.46 40.46 0 0039.1 29.5h232.8a40.88 40.88 0 0039.3-29.5l51.7-182.3.6-5.5a20.38 20.38 0 00-20.4-20.2H68.4zm193.32 160.07A42.07 42.07 0 11304 310a42.27 42.27 0 01-42.28 42.07z" fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32"/><path fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" d="M160 192l96-128 96 128"/></svg>
				-->
				
				<a>Læg i kurv</a>
			</div>
		}
	}

</div>

@code {
	[Parameter] public int Id { get; set; }
	[Parameter] public string Img { get; set; }
    [Parameter] public string name { get; set; }
	[Parameter] public double price { get; set; }
	[Parameter] public bool InStock { get; set; }
	[Parameter] public bool? InBasket { get; set; } 
	[Parameter] public int? amount { get; set; }
	[Parameter] public int quantity { get; set; }
	[Parameter] public string description { get; set; }

	// FORMATER PRISEN 29,85 kr
	public string PrettyPrice() {
		return "";
	}
	
	private BasketService _basketService = BasketService.getInstance();

	protected override void OnInitialized()
	{
		InStock = _basketService.InBasketStock(Id);
		StateHasChanged();
		base.OnInitialized();
	}

	private async void AddToBasket()
	{
		if (InStock)
		{
			InStock = await _basketService.AddItem(Id);
		};
	}

	private void RemoveFromBasket()
	{
		BasketService.getInstance().RemoveItem(Id);
	}
}

