@page "/kurv"
@using global::Shared
@inject NavigationManager Nvm

<div class="bp-container">
	
	<div class="bp-top">
		<div class="icon">
			<svg xmlns="http://www.w3.org/2000/svg" class="ionicon" viewBox="0 0 512 512"><circle cx="176" cy="416" r="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"/><circle cx="400" cy="416" r="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"/><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M48 80h64l48 272h256"/><path d="M160 288h249.44a8 8 0 007.85-6.43l28.8-144a8 8 0 00-7.85-9.57H128" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"/></svg>
		</div>
		Din indkÃ¸bskurv
		<div class="bp-basket-amount">
			(@_BasketItems.Count varer)
		</div>
	</div>
	<div class="bp-content">
		<div class="bp-scroll-box">
			<div class="bp-basket-content">
				@foreach (Product product in _BasketItems.Values)
				{
					<BasketPageItem
						id="@product.Id"
						Img=@product.Image
						name=@product.name
						Price=@product.Price
						amount=@product.amount
						quantity=@product.quantity
						onQuantityChanged="value => UpdateBasket()"/>
				}
			</div>
		</div>
		<div class="bp-summary">
			<div class="bp-header">Ordreoversigt</div>
			<hr>
			<div class="bp-free-shipping">
				Du har opnÃ¥et fri fragt ðŸŽ‰
				<div class="bp-progress">
					<div class="bp-bar"></div>
				</div>
			</div>
			<hr>
			<div class="bp-items">
				<div class="bp-space">
					<div class="bp-title">Produkter</div>
					<div class="bp-total">@totalPrice kr</div>
				</div>

				<div class="bp-space">
					<div class="bp-title">Levering</div>
					<div class="bp-total">Fri fragt</div>
				</div>
			</div>
			<hr>
			<div class="bp-main-total">
				<div class="bp-space">
					<div class="bp-title">Total pris</div>
					<div class="bp-total">@BasketService.getInstance().getBasketTotal() kr</div>
				</div>
				<div class="bp-total-info">(Inkl. moms)</div>
			</div>
			<div class="primary-button" @onclick="OnClick">
				GÃ¥ til checkout
			</div>
			<div class="bp-icons">
				<img src="https://scale.coolshop-cdn.com/static.coolshop-cdn.com/images/payment%20icons/pay-icon-dk.png?borderless=1&transparent=1&width=100&height=60"/>
				<img src="https://storage.googleapis.com/static.coolshop-cdn.com/images/payment%20icons/google-pay-mark.svg"/>
				<img src="https://storage.googleapis.com/static.coolshop-cdn.com/images/payment%20icons/pay-icon-apple-pay.svg"/>
				<img src="https://scale.coolshop-cdn.com/static.coolshop-cdn.com/images/payment%20icons/pay-icon-visa.png?borderless=1&transparent=1&width=140&height=60"/>
				<img src="https://storage.googleapis.com/static.coolshop-cdn.com/images/payment%20icons/pay-icon-master_symbol.svg"/>
				<img src="https://storage.googleapis.com/static.coolshop-cdn.com/images/payment%20icons/pay-icon-mobile-pay.svg"/>

			</div>
		</div>
	</div>
</div>


@code {
	
    public void OnClick()
    {
        Nvm.NavigateTo("/form");
    }
	
	private Dictionary<int, Product> _BasketItems { get; set; }

	private double totalPrice { get; set; }
    
	public void UpdateBasket()
	{
		BasketService basketService = BasketService.getInstance();
		_BasketItems = basketService.GetBasketItems();
		totalPrice = basketService.getBasketTotal();
		StateHasChanged();
	}

	protected override Task OnInitializedAsync()
	{
		BasketService.getInstance().on("Changed", args => UpdateBasket());
		UpdateBasket();
		return base.OnInitializedAsync();
	}

}